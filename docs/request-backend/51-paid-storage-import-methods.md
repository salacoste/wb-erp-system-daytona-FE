# Request #51: Paid Storage Import Methods Documentation

**Date**: 2025-12-07
**Updated**: 2025-12-14 (Rate limit protection added)
**Status**: ‚úÖ Implemented
**Epic**: Epic 24 - Paid Storage Analytics

---

## Overview

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–≤–∞ –º–µ—Ç–æ–¥–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑ WB API:

| –ú–µ—Ç–æ–¥ | Endpoint | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|----------|------------|
| **Manual Import** | `POST /v1/imports/paid-storage` | –ò–º–ø–æ—Ä—Ç –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (—è–≤–Ω—ã–µ –¥–∞—Ç—ã) |
| **Smart Import** | `POST /v1/imports/paid-storage/smart` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î |

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –¥–∞–Ω–Ω—ã—Ö:
- `GET /v1/imports/paid-storage/status` ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î

---

## –í–∞–∂–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ WB API

> ‚ö†Ô∏è **WB Paid Storage API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2-3 –Ω–µ–¥–µ–ª–∏.**
>
> –î–ª—è –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ (>2 –º–µ—Å—è—Ü–µ–≤) API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Å–∫–∏–¥–∫–∏,
> –Ω–æ –ù–ï –±–∞–∑–æ–≤—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ("–∫–æ—Ä–æ–±–∞").

**–ü—Ä–∏–º–µ—Ä —Ä–∞–∑–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö:**

| –ü–µ—Ä–∏–æ–¥ | –î–∞–Ω–Ω—ã–µ –∏–∑ API | calcType | –°—É–º–º–∞ |
|--------|---------------|----------|-------|
| –û–∫—Ç—è–±—Ä—å 2025 | –¢–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ | NULL, "—Å–∫–∏–¥–∫–∞..." | -1,063‚ÇΩ |
| –ù–æ—è–±—Ä—å 2025 | –ü–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | "–∫–æ—Ä–æ–±–∞: —Ç–æ–≤–∞—Ä—ã...", "—Å–∫–∏–¥–∫–∞..." | +2,500‚ÇΩ |

**–í—ã–≤–æ–¥**: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ **–µ–∂–µ–¥–Ω–µ–≤–Ω–æ**, –ø–æ–∫–∞ –æ–Ω–∏ —Å–≤–µ–∂–∏–µ.

---

## SDK Workflow (–ö–†–ò–¢–ò–ß–ù–û - –æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-15)

> ‚ö†Ô∏è **–í–ê–ñ–ù–û**: Paid Storage API —Ä–∞–±–æ—Ç–∞–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** —á–µ—Ä–µ–∑ task-based workflow!

### 3-Step Task-Based Workflow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. paidStorage()    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ 2. getTasksStatu3() ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ 3. getTasksDownload3‚îÇ
‚îÇ    —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏  ‚îÇ     ‚îÇ    –ø–æ–ª–ª–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞  ‚îÇ     ‚îÇ    —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö‚îÇ
‚îÇ    ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç     ‚îÇ     ‚îÇ    –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫     ‚îÇ     ‚îÇ    ‚Üí JSON –º–∞—Å—Å–∏–≤    ‚îÇ
‚îÇ      taskId         ‚îÇ     ‚îÇ    –¥–æ status='done' ‚îÇ     ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª**: `src/imports/services/paid-storage-import.service.ts`, –º–µ—Ç–æ–¥ `fetchPaidStorageData()`

```typescript
// Step 1: –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
const taskResponse = await sdk.reports.paidStorage({ dateFrom, dateTo });
const taskId = taskResponse.data?.taskId;

// Step 2: –ü–æ–ª–ª–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ (–º–∞–∫—Å 2 –º–∏–Ω, –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫)
while (status !== 'done' && !timeout) {
  await wait(5000);
  const statusResponse = await sdk.reports.getTasksStatu3(taskId);
  status = statusResponse.data?.status;
}

// Step 3: –°–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
const data = await sdk.reports.getTasksDownload3(taskId);
```

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á–∏

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|----------|
| `done` | –ó–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ | –°–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ |
| `canceled` | –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ | –û—à–∏–±–∫–∞ |
| `purged` | –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã | –û—à–∏–±–∫–∞ |
| (–¥—Ä—É–≥–∏–µ) | –í –æ–±—Ä–∞–±–æ—Ç–∫–µ | –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–ª–ª–∏–Ω–≥ |

---

## Rate Limiting (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-15)

WB SDK –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤. –ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ –ª–∏–º–∏—Ç—ã:

| –ú–µ—Ç–æ–¥ SDK | –õ–∏–º–∏—Ç | –ù–∞—à–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
|-----------|-------|-----------------|
| `paidStorage()` (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏) | 1 req/min | 65s –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É chunks |
| `getTasksStatu3()` (polling) | ~1 req/5sec | 5s –∏–Ω—Ç–µ—Ä–≤–∞–ª |
| `getTasksDownload3()` (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ) | 1 req/min | –û–¥–∏–Ω –≤—ã–∑–æ–≤ –Ω–∞ chunk |

### –í—Ä–µ–º—è –∏–º–ø–æ—Ä—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–µ—Ä–∏–æ–¥–∞

| –ü–µ—Ä–∏–æ–¥ | Chunks | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É chunks | ~–û–±—â–µ–µ –≤—Ä–µ–º—è |
|--------|--------|----------------------|--------------|
| ‚â§8 –¥–Ω–µ–π | 1 | –ù–µ—Ç | 5-30 —Å–µ–∫ |
| 9-16 –¥–Ω–µ–π | 2 | 65—Å √ó 1 | ~1.5 –º–∏–Ω |
| 17-24 –¥–Ω–µ–π | 3 | 65—Å √ó 2 | ~2.5 –º–∏–Ω |
| 25-32 –¥–Ω–µ–π | 4 | 65—Å √ó 3 | ~3.5 –º–∏–Ω |
| 30 –¥–Ω–µ–π (–º–µ—Å—è—Ü) | 4 | 65—Å √ó 3 | ~3.5 –º–∏–Ω |

> üí° **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: Smart Import (`initial_7_days` –∏–ª–∏ `daily_incremental`) –Ω–µ –∏–º–µ–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫, —Ç–∞–∫ –∫–∞–∫ –≤—Å–µ–≥–¥–∞ —É–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –æ–¥–∏–Ω chunk (‚â§7 –¥–Ω–µ–π).

---

## Method 1: Manual Import

### –û–ø–∏—Å–∞–Ω–∏–µ
–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ **—è–≤–Ω–æ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥**. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞ –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞—Ç–∞–º–∏.

### Endpoint
```http
POST /v1/imports/paid-storage
Authorization: Bearer <token>
X-Cabinet-Id: <cabinet-uuid>
Content-Type: application/json
```

### Request Body
```json
{
  "dateFrom": "2025-12-01",
  "dateTo": "2025-12-07"
}
```

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------------|----------|
| `dateFrom` | string (YYYY-MM-DD) | ‚úÖ –î–∞ | –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ |
| `dateTo` | string (YYYY-MM-DD) | ‚úÖ –î–∞ | –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ) |

### Response (202 Accepted)
```json
{
  "import_id": "job-123",
  "status": "queued",
  "date_range": {
    "from": "2025-12-01",
    "to": "2025-12-07"
  },
  "rows_imported": 0,
  "message": "Import queued for processing."
}
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- **Max 8 –¥–Ω–µ–π** –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ WB API)
- –î–ª—è –±–æ–ª—å—à–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏–≤–∞–µ—Ç –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **Rate limit**: 65 —Å–µ–∫—É–Ω–¥ –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É chunk-–∑–∞–ø—Ä–æ—Å–∞–º–∏ (SDK compliance, 2025-12-14)

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
- –†—É—á–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –¥–∞—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏

---

## Method 2: Smart Import

### –û–ø–∏—Å–∞–Ω–∏–µ
**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞** –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î:

| –£—Å–ª–æ–≤–∏–µ | –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –ü–µ—Ä–∏–æ–¥ |
|---------|-----------|--------|
| –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î | `initial_7_days` | –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π |
| –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å | `daily_incremental` | –¢–æ–ª—å–∫–æ –≤—á–µ—Ä–∞ |

### Endpoint
```http
POST /v1/imports/paid-storage/smart
Authorization: Bearer <token>
X-Cabinet-Id: <cabinet-uuid>
```

### Request Body
–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ –ø—É—Å—Ç–æ–µ –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç).

### Response (202 Accepted)
```json
{
  "import_id": "job-456",
  "status": "queued",
  "import_strategy": "daily_incremental",
  "message": "Existing data found - will import yesterday only"
}
```

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `import_id` | ID –∑–∞–¥–∞—á–∏ –≤ BullMQ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è |
| `status` | –°—Ç–∞—Ç—É—Å: `queued` |
| `import_strategy` | –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: `initial_7_days` –∏–ª–∏ `daily_incremental` |
| `message` | –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è |

### –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  POST /v1/imports/paid-storage/smart ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚ñº
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚îÇ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î:  ‚îÇ
         ‚îÇ –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ‚îÇ
         ‚îÇ –¥–ª—è –∫–∞–±–∏–Ω–µ—Ç–∞? ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚ñº                 ‚ñº
   –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö        –î–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
        ‚îÇ                 ‚îÇ
        ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ initial_7_days‚îÇ  ‚îÇdaily_increment‚îÇ
‚îÇ               ‚îÇ  ‚îÇ               ‚îÇ
‚îÇ –ò–º–ø–æ—Ä—Ç –∑–∞     ‚îÇ  ‚îÇ –ò–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ ‚îÇ
‚îÇ –ø–æ—Å–ª–µ–¥–Ω–∏–µ     ‚îÇ  ‚îÇ –∑–∞ –≤—á–µ—Ä–∞      ‚îÇ
‚îÇ 7 –¥–Ω–µ–π        ‚îÇ  ‚îÇ               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –∏–º–ø–æ—Ä—Ç** (cron 06:00 MSK)
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞—Ç—ã
- –ü–µ—Ä–≤—ã–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
- –ö–æ–≥–¥–∞ –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —Ç–µ–∫—É—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

---

## Data Status Endpoint

### –û–ø–∏—Å–∞–Ω–∏–µ
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ –¥–∞–Ω–Ω—ã—Ö –ø–ª–∞—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î –¥–ª—è –∫–∞–±–∏–Ω–µ—Ç–∞.

### Endpoint
```http
GET /v1/imports/paid-storage/status
Authorization: Bearer <token>
X-Cabinet-Id: <cabinet-uuid>
```

### Response (200 OK)
```json
{
  "hasData": true,
  "recordCount": 1934,
  "oldestDate": "2025-10-13",
  "newestDate": "2025-12-05",
  "lastImportDate": "2025-12-07T04:33:52Z"
}
```

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `hasData` | boolean | –ï—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `paid_storage_daily` |
| `recordCount` | number | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π |
| `oldestDate` | string \| null | –°–∞–º–∞—è —Ä–∞–Ω–Ω—è—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö |
| `newestDate` | string \| null | –°–∞–º–∞—è –ø–æ–∑–¥–Ω—è—è –¥–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö |
| `lastImportDate` | string \| null | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ |

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –∏–º–ø–æ—Ä—Ç–æ–º
- UI: –ø–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∞—Ç—É—Å –¥–∞–Ω–Ω—ã—Ö

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Manual Import | Smart Import |
|----------------|---------------|--------------|
| **–¢—Ä–µ–±—É–µ—Ç –¥–∞—Ç—ã** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |
| **–ê–≤—Ç–æ–≤—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ cron** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (06:00 MSK) |
| **–ü–µ—Ä–≤—ã–π –∏–º–ø–æ—Ä—Ç** | –£–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 7 –¥–Ω–µ–π |
| **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π** | –£–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—á–µ—Ä–∞ |
| **–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –¥–∞—Ç–∞–º–∏** | ‚úÖ –ü–æ–ª–Ω—ã–π | ‚ùå –ù–µ—Ç |
| **–î–ª—è –æ—Ç–ª–∞–¥–∫–∏** | ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ |

---

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

### Daily Cron Job (06:00 MSK)

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç smart import –¥–ª—è –≤—Å–µ—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤:

```
Daily at 06:00 MSK (03:00 UTC):
‚îú‚îÄ‚îÄ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞ —Å WB API –∫–ª—é—á–æ–º:
‚îÇ   ‚îú‚îÄ‚îÄ –í—ã–∑–æ–≤ smartImport(cabinetId)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ?
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ –ù–µ—Ç ‚Üí import(7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥ ... –≤—á–µ—Ä–∞)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ –î–∞ ‚Üí import(—Ç–æ–ª—å–∫–æ –≤—á–µ—Ä–∞)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ª–æ–≥
‚îÇ   ‚îî‚îÄ‚îÄ –û—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö –∫–∞–±–∏–Ω–µ—Ç–æ–≤
‚îî‚îÄ‚îÄ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç: X —É—Å–ø–µ—à–Ω–æ, Y –æ—à–∏–±–æ–∫, Z —Å—Ç—Ä–æ–∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ
```

**–ü–æ—á–µ–º—É 06:00 MSK?**
- WB —Ñ–∏–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å –Ω–æ—á—å—é
- –ö 06:00 –¥–∞–Ω–Ω—ã–µ –∑–∞ –≤—á–µ—Ä–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ—Å—Ç—É–ø–Ω—ã
- –ó–∞–ø—É—Å–∫ –¥–æ –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è –≤ –†–æ—Å—Å–∏–∏

### Auto-Import –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ WB –∫–ª—é—á–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ `wb_api_token`:
1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –∏–º–ø–æ—Ä—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ (06:00 MSK)

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–≤—ã–π –∏–º–ø–æ—Ä—Ç –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
```bash
# Smart import –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç
curl -X POST "https://api.example.com/v1/imports/paid-storage/smart" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Cabinet-Id: $CABINET_ID"

# Response:
# {
#   "import_strategy": "initial_7_days",
#   "message": "No existing data - will import last 7 days"
# }
```

### –ü—Ä–∏–º–µ—Ä 2: –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
# Smart import –æ–ø—Ä–µ–¥–µ–ª–∏—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å
curl -X POST "https://api.example.com/v1/imports/paid-storage/smart" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Cabinet-Id: $CABINET_ID"

# Response:
# {
#   "import_strategy": "daily_incremental",
#   "message": "Existing data found - will import yesterday only"
# }
```

### –ü—Ä–∏–º–µ—Ä 3: –†—É—á–Ω–æ–π –∏–º–ø–æ—Ä—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–µ—Ä–∏–æ–¥
```bash
curl -X POST "https://api.example.com/v1/imports/paid-storage" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Cabinet-Id: $CABINET_ID" \
  -H "Content-Type: application/json" \
  -d '{"dateFrom": "2025-12-01", "dateTo": "2025-12-07"}'

# Response:
# {
#   "date_range": {"from": "2025-12-01", "to": "2025-12-07"},
#   "message": "Import queued for processing."
# }
```

### –ü—Ä–∏–º–µ—Ä 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–∞–Ω–Ω—ã—Ö
```bash
curl -X GET "https://api.example.com/v1/imports/paid-storage/status" \
  -H "Authorization: Bearer $TOKEN" \
  -H "X-Cabinet-Id: $CABINET_ID"

# Response:
# {
#   "hasData": true,
#   "recordCount": 1934,
#   "oldestDate": "2025-10-13",
#   "newestDate": "2025-12-06"
# }
```

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

| HTTP Code | –°–∏—Ç—É–∞—Ü–∏—è | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------|----------|----------|
| 400 | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD |
| 401 | –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π —Ç–æ–∫–µ–Ω | –û–±–Ω–æ–≤–∏—Ç—å JWT |
| 403 | –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–±–∏–Ω–µ—Ç—É | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å X-Cabinet-Id |
| 404 | –ö–∞–±–∏–Ω–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞ |
| 429 | Rate limit | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Retry-After —Å–µ–∫—É–Ω–¥ |
| 500 | –û—à–∏–±–∫–∞ WB API | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ |

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `src/imports/imports.controller.ts` | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å endpoints |
| `src/imports/services/paid-storage-import.service.ts` | –°–µ—Ä–≤–∏—Å —Å –ª–æ–≥–∏–∫–æ–π `smartImport()` |
| `src/imports/processors/paid-storage-import.processor.ts` | BullMQ processor |
| `src/tasks/services/task-scheduler.service.ts` | Daily cron job |

---

## –°–º. —Ç–∞–∫–∂–µ

- [Epic 24: Paid Storage by Article](../../../docs/epics/epic-24-paid-storage-by-article.md)
- [Story 24.4: Auto Scheduler](../../../docs/stories/epic-24/story-24.4-auto-scheduler.md)
- [API Reference: Paid Storage Import](../../../docs/API-PATHS-REFERENCE.md#paid-storage-import-epic-24)
- [Storage API Guide](../../../docs/STORAGE-API-GUIDE.md) ‚Äî SDK workflow, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, troubleshooting
- [Request #39: Storage Data Sources Discrepancy](./135-storage-data-sources-discrepancy.md) ‚Äî –∞–Ω–∞–ª–∏–∑ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
