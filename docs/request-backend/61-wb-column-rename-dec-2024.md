# Request #61: WB Financial Reports Column Rename (December 2024)

**Date**: 2024-12-15
**Type**: Breaking Change Notification
**Priority**: HIGH
**Effective Date**: 2024-12-22
**Status**: ⏳ Pending Implementation

---

## Context

Wildberries объявил о техническом переименовании категорий затрат в финансовых отчётах. Изменения вступают в силу **с 22 декабря 2024** в еженедельных отчётах.

Это изменение техническое и не влияет на бизнес-логику расчётов. Затронуты только названия столбцов и значения поля "Обоснование для оплаты".

---

## Changes Summary

### Переименование "Обоснование для оплаты" (reason field)

| Старое значение | Новое значение |
|-----------------|----------------|
| `Платная приёмка` | `Обработка товара` |
| `Платная приёмка МП по коробам` | `Обработка товара МП по коробам` |

### Переименование заголовков столбцов

| Старый заголовок | Новый заголовок |
|------------------|-----------------|
| `Платная приёмка` | `Операции при приёмке` |
| `Номер короба для платной приёмки` | `Номер короба для обработки товара` |

---

## Backend Requirements

### 1. Column Synonyms Update

Backend должен поддерживать **оба** варианта названий (старый и новый) для обратной совместимости:

```typescript
// Поддержка старых и новых названий столбцов
const COLUMN_SYNONYMS = {
  // Старые названия (до 22.12.2024) - продолжаем поддерживать
  'Платная приёмка': 'paid_acceptance',
  'Номер короба для платной приёмки': 'paid_acceptance_box_number',

  // Новые названия (с 22.12.2024)
  'Операции при приёмке': 'paid_acceptance',
  'Номер короба для обработки товара': 'paid_acceptance_box_number',
};
```

### 2. Reason Classification Update

Классификация строк по полю `reason` должна поддерживать новые значения:

```typescript
// Старые и новые значения reason
const PAID_ACCEPTANCE_REASONS = [
  // Старые (до 22.12.2024)
  'Платная приёмка',
  'Платная приёмка МП по коробам',

  // Новые (с 22.12.2024)
  'Обработка товара',
  'Обработка товара МП по коробам',
];
```

### 3. API Contract

**Изменения API не требуются**. Поля в ответах остаются прежними:
- `paid_acceptance_cost` - в `weekly_payout_summary`
- `paidAcceptanceCost` - в DTO responses

---

## Frontend Impact

### Minimal Impact

Frontend использует внутренние имена полей (`paidAcceptanceCost`), которые не меняются.

### Display Labels (Optional)

Если frontend отображает названия категорий пользователю, можно обновить отображаемые названия:

```typescript
// Локализация для отображения
const EXPENSE_LABELS = {
  paidAcceptanceCost: 'Операции при приёмке', // было: 'Платная приёмка'
};
```

---

## Testing Plan

### Before 22.12.2024
- [ ] Убедиться что текущий импорт работает со старыми названиями

### After 22.12.2024
- [ ] Загрузить первый отчёт с новыми названиями
- [ ] Проверить что `paid_acceptance_cost` рассчитывается корректно
- [ ] Сравнить `payout_total` с WB Dashboard
- [ ] Проверить смешанный импорт (старые + новые отчёты)

---

## Timeline

| Date | Action |
|------|--------|
| 2024-12-15 | Документация создана |
| 2024-12-16 - 21 | Реализация поддержки новых названий |
| 2024-12-22 | Изменения вступают в силу в WB |
| 2024-12-22 - 29 | Тестирование на реальных данных |

---

## Related Documents

- `docs/WB-COLUMN-RENAME-2024-12-22.md` - Полная техническая документация
- `docs/WB-DASHBOARD-METRICS.md` - Формула payout_total
- `CLAUDE.md` - ETL Pipeline & Column Mapping section

---

## Backend Response

**Status**: ⏳ Pending

_Backend team response will be added here after implementation._
