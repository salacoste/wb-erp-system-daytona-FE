# Request #82: Backend Response - –°–∫–ª–µ–π–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ (Card Linking)

**Date**: 2025-12-27
**Status**: ‚úÖ –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
**Prepared by**: Backend Team (Claude Code)

---

## üéØ Executive Summary

–ü–æ—Å–ª–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è WB API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ SDK:

**‚ùå WB API –ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Å–∫–ª–µ–π–∫–∞—Ö –∫–∞—Ä—Ç–æ—á–µ–∫**

- ‚úÖ API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç spend/revenue –ø–æ –∫–∞–∂–¥–æ–º—É nmId
- ‚ùå API –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç parent-child —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–æ–≤–∞—Ä–∞–º–∏
- ‚ùå API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ö–∞–Ω–∏–∑–º–µ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂
- ‚úÖ –î–∞–Ω–Ω—ã–µ "spend=0, revenue>0" —è–≤–ª—è—é—Ç—Å—è **–≤–∞–ª–∏–¥–Ω—ã–º–∏** –æ—Ç WB

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ "as-is", –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å frontend tooltip –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–∏—è.

---

## üìä –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ WB API

### 1. –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏

**SDK Documentation** (`daytona-wildberries-typescript-sdk`):
- ‚úÖ `getFullstats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–º–ø–∞–Ω–∏–π
- ‚úÖ `getAuctionAdverts()` - –¥–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–π type 9
- ‚úÖ `getPromotionCount()` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–º–ø–∞–Ω–∏–π
- ‚ùå **–ù–ï–¢** –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è card linking/bundling

**WB API Documentation** (`dev.wildberries.ru`):
- ‚úÖ `/adv/v2/fullstats` - –ø–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ `/content/v2/cards/upload/add` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ —Å merge
- ‚ùå **–ù–ï–¢** endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∫–ª–µ–µ–∫

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ `/adv/v2/fullstats`

**WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç** (excerpt):
```json
{
  "advertId": 10524818,
  "days": [
    {
      "date": "2023-10-06T03:00:00+03:00",
      "views": 414,
      "clicks": 1,
      "sum": 70,  // Spend –∫–∞–º–ø–∞–Ω–∏–∏
      "apps": [
        {
          "nm": [
            {
              "nmId": 111111111111,
              "name": "–¢–∞–ø–æ—á–∫–∏",
              "views": 25,
              "clicks": 0,
              "sum": 4,        // ‚Üê Spend –¥–ª—è nmId
              "sum_price": 0,  // ‚Üê Revenue –¥–ª—è nmId
              "orders": 0
            }
          ]
        }
      ]
    }
  ]
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è**:
- `advertId` - ID —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏
- `nmId` - –∞—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞
- `sum` - –∑–∞—Ç—Ä–∞—Ç—ã –Ω–∞ —Ä–µ–∫–ª–∞–º—É (spend)
- `sum_price` - –ø—Ä–æ–¥–∞–∂–∏ –æ—Ç —Ä–µ–∫–ª–∞–º—ã (revenue)
- `views`, `clicks`, `orders` - –º–µ—Ç—Ä–∏–∫–∏

**‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è** (–Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ API):
- `parent_nm_id` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞
- `linked_nm_ids` - —Å–∫–ª–µ–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
- `is_linked_product` - —Ñ–ª–∞–≥ —Å–∫–ª–µ–π–∫–∏
- `attributed_from_parent` - –∏—Å—Ç–æ—á–Ω–∏–∫ –∞—Ç—Ä–∏–±—É—Ü–∏–∏

---

## ‚ùì –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã Frontend

### –í–æ–ø—Ä–æ—Å 1: –ì–¥–µ –≤ WB API –¥–∞–Ω–Ω—ã–µ –æ —Å–∫–ª–µ–π–∫–∞—Ö?

**–û—Ç–≤–µ—Ç**: ‚ùå **–ù–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è**

WB API **–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç** –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∫–ª–µ–π–∫–∞—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
- –ù–µ—Ç –ø–æ–ª–µ–π –¥–ª—è parent/child —Å–≤—è–∑–µ–π –º–µ–∂–¥—É nmId
- –ù–µ—Ç endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è card linking
- –ú–µ—Ç–æ–¥ `/content/v2/cards/upload/add` (create with merge) - —ç—Ç–æ –ø—Ä–æ —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞, **–Ω–µ –ø—Ä–æ —Ä–µ–∫–ª–∞–º—É**

**–í—ã–≤–æ–¥**: –°–∫–ª–µ–π–∫–∏ - —ç—Ç–æ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ö–∞–Ω–∏–∑–º** WB –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–π —á–µ—Ä–µ–∑ API.

---

### –í–æ–ø—Ä–æ—Å 2: –ö–∞–∫ WB –∞—Ç—Ä–∏–±—É—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–¥–∞–∂–∏?

**–û—Ç–≤–µ—Ç**: ‚ö†Ô∏è **–ú–µ—Ö–∞–Ω–∏–∑–º –∞—Ç—Ä–∏–±—É—Ü–∏–∏ –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω**

WB API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `sum_price` (revenue) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ nmId, **–Ω–æ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç**:
- –ü–æ—á–µ–º—É revenue > 0 –ø—Ä–∏ spend = 0
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ attribution window (–æ–∫–Ω–æ –∞—Ç—Ä–∏–±—É—Ü–∏–∏)
- –û—Ç –∫–∞–∫–æ–π –∫–∞–º–ø–∞–Ω–∏–∏ –ø—Ä–∏—à–ª–∞ –ø—Ä–æ–¥–∞–∂–∞ (–µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö)
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç "—Å–∫–ª–µ–π–∫–∏" –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞—Ç—Ä–∏–±—É—Ü–∏–∏

**–ì–∏–ø–æ—Ç–µ–∑–∞** (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –æ—Ç PO):
1. –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–ª–∏–∫–∏ (spend > 0)
2. –ü–æ–∫—É–ø–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∫–ª–µ–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
3. WB –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–¥–∞–∂—É —Å–∫–ª–µ–µ–Ω–Ω–æ–º—É —Ç–æ–≤–∞—Ä—É (revenue > 0)
4. **–ù–û** API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É –Ω–∏–º–∏

**–í—ã–≤–æ–¥**: WB —Å—á–∏—Ç–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ü–∏—é **–Ω–∞ —Å–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω–µ** –∏ –æ—Ç–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (spend/revenue –ø–æ nmId).

---

### –í–æ–ø—Ä–æ—Å 3: –ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã?

**–û—Ç–≤–µ—Ç**: ‚ùå **–ù–µ–ª—å–∑—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ —Å–≤—è–∑—è—Ö**

–î–ª—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ:
```
ter-13-1 (parent): spend=11,337‚ÇΩ
  ‚îú‚îÄ ter-09 (child): revenue=1,105‚ÇΩ
  ‚îú‚îÄ ter-10 (child): revenue=1,489‚ÇΩ
  ‚îî‚îÄ ter-11 (child): revenue=1,512‚ÇΩ

–§–æ—Ä–º—É–ª–∞:
ter-09 adjusted_spend = 11,337 √ó (1,105 / total_linked_revenue)
```

**–ü—Ä–æ–±–ª–µ–º–∞**: WB API **–Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç**:
- –ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã —Å–∫–ª–µ–µ–Ω—ã (parent-child —Å–≤—è–∑–∏)
- –ö–∞–∫–æ–π –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ —è–≤–ª—è–µ—Ç—Å—è "–æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π"
- –°—É–º–º–∞—Ä–Ω—ã–π revenue –≤—Å–µ—Ö —Å–∫–ª–µ–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

**–í—ã–≤–æ–¥**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ** –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö –æ—Ç WB API.

---

### –í–æ–ø—Ä–æ—Å 4: –ù—É–∂–Ω—ã –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î?

**–û—Ç–≤–µ—Ç**: ‚ùå **–ù–ï –Ω—É–∂–Ω—ã** (–¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è)

**–¢–µ–∫—É—â–∞—è —Å—Ö–µ–º–∞** (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞):
```prisma
model AdvCampaign {
  id          String   @id @default(uuid()) @db.Uuid
  advertId    Int      @unique @map("advert_id")
  nmIds       Int[]    @map("nm_ids")  // –ú–∞—Å—Å–∏–≤ –∞—Ä—Ç–∏–∫—É–ª–æ–≤ –≤ –∫–∞–º–ø–∞–Ω–∏–∏
  // ‚ùå parent_nm_id - WB API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç
  // ‚ùå linked_nm_ids - WB API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç
}

model AdvDailyStat {
  id         String   @id @default(uuid()) @db.Uuid
  nmId       Int      @map("nm_id")
  views      Int      @default(0)
  clicks     Int      @default(0)
  spend      Decimal  @default(0) @db.Decimal(10, 2)
  revenue    Decimal  @default(0) @db.Decimal(10, 2)
  // ‚ùå is_linked_product - WB API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç
  // ‚ùå parent_nm_id - WB API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç
}
```

**–ü–æ—á–µ–º—É –Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –ø–æ–ª—è**:
1. WB API –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ
2. –ó–∞–ø–æ–ª–Ω—è—Ç—å –∏—Ö –Ω–µ—á–µ–º (–Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ –∑–Ω–∞–Ω–∏—è —Å–≤—è–∑–µ–π

**–í—ã–≤–æ–¥**: –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ WB API "as-is".

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### Backend Strategy: Store Raw WB Data

**–ü—Ä–∏–Ω—Ü–∏–ø**: –°–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ WB API **–±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π**

```typescript
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è AdvSyncService - –ü–†–ê–í–ò–õ–¨–ù–ê–Ø
async syncDailyStats(cabinet: Cabinet, daysBack: number) {
  const stats = await wbSDK.promotion.getFullstats({ id, dates });

  for (const day of stats.days) {
    for (const app of day.apps) {
      for (const nm of app.nm) {
        await prisma.advDailyStats.upsert({
          where: { /* composite key */ },
          update: {
            views: nm.views,
            clicks: nm.clicks,
            spend: nm.sum,      // ‚Üê –ú–æ–∂–µ—Ç –±—ã—Ç—å 0
            revenue: nm.sum_price,  // ‚Üê –ú–æ–∂–µ—Ç –±—ã—Ç—å > 0
            orders: nm.orders
          }
        });
      }
    }
  }
}
```

**‚úÖ –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º**:
- `spend = 0` - –µ—Å–ª–∏ WB API –≤–µ—Ä–Ω—É–ª 0
- `revenue > 0` - –µ—Å–ª–∏ WB API –≤–µ—Ä–Ω—É–ª > 0
- **–ù–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º** –¥–∞–Ω–Ω—ã–µ –æ—Ç WB

**‚ùå –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ–º**:
- ‚ùå –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
- ‚ùå –í—ã—á–∏—Å–ª–µ–Ω–∏–µ "adjusted_spend"
- ‚ùå –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π parent_nm_id/linked_nm_ids

---

### Frontend Strategy: Display As-Is + Tooltip

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ "as-is" —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### Option 1: Tooltip –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" (–†–ï–ö–û–ú–ï–ù–î–û–í–ê–ù–û)

```tsx
// EfficiencyBadge.tsx
{efficiency.status === 'unknown' && (
  <Tooltip>
    <TooltipTrigger>
      <Badge variant="secondary">üîµ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</Badge>
    </TooltipTrigger>
    <TooltipContent>
      <div className="space-y-1">
        <p className="font-medium">–ù–µ—Ç –ø—Ä—è–º—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∑–∞—Ç—Ä–∞—Ç</p>
        <p className="text-xs text-muted-foreground">
          –ü—Ä–æ–¥–∞–∂–∏ –∞—Ç—Ä–∏–±—É—Ç–∏—Ä–æ–≤–∞–Ω—ã WB –∫ —Ä–µ–∫–ª–∞–º–µ, –Ω–æ –∑–∞—Ç—Ä–∞—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.
          –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
        </p>
        <ul className="text-xs text-muted-foreground list-disc pl-4 space-y-0.5">
          <li>–¢–æ–≤–∞—Ä —Å–∫–ª–µ–µ–Ω —Å –¥—Ä—É–≥–æ–π –∫–∞—Ä—Ç–æ—á–∫–æ–π</li>
          <li>–ü—Ä–æ–¥–∞–∂–∏ –æ—Ç –∫–∞–º–ø–∞–Ω–∏–π –±–µ–∑ –ø—Ä—è–º–æ–≥–æ —É—á–∞—Å—Ç–∏—è</li>
          <li>Attribution window –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–µ—Ä–∏–æ–¥–æ–≤</li>
        </ul>
      </div>
    </TooltipContent>
  </Tooltip>
)}
```

#### Option 2: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```tsx
// PerformanceMetricsTable.tsx
<TableCell>
  {row.spend === 0 && row.revenue > 0 ? (
    <div className="flex items-center gap-2">
      <span className="text-muted-foreground">0‚ÇΩ</span>
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger>
            <InfoIcon className="w-4 h-4 text-blue-500" />
          </TooltipTrigger>
          <TooltipContent>
            –ü—Ä–æ–¥–∞–∂–∏ –∞—Ç—Ä–∏–±—É—Ç–∏—Ä–æ–≤–∞–Ω—ã –±–µ–∑ –ø—Ä—è–º—ã—Ö –∑–∞—Ç—Ä–∞—Ç
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>
    </div>
  ) : (
    <span>{formatCurrency(row.spend)}</span>
  )}
</TableCell>
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ (–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏)

| –ê—Ä—Ç–∏–∫—É–ª | Spend | Revenue | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|---------|-------|---------|------------|
| ter-09 | 0‚ÇΩ | 1,105‚ÇΩ | WB API –≤–µ—Ä–Ω—É–ª spend=0, revenue>0. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã: —Å–∫–ª–µ–π–∫–∞, attribution window, –∫–∞–º–ø–∞–Ω–∏–∏ –±–µ–∑ –ø—Ä—è–º–æ–≥–æ —É—á–∞—Å—Ç–∏—è |
| ter-10 | 0‚ÇΩ | 1,489‚ÇΩ | –¢–æ –∂–µ —Å–∞–º–æ–µ |
| ter-11 | 0‚ÇΩ | 1,512‚ÇΩ | –¢–æ –∂–µ —Å–∞–º–æ–µ |
| izo30white | 0‚ÇΩ | 1,113‚ÇΩ | –¢–æ –∂–µ —Å–∞–º–æ–µ |

**–í–∞–∂–Ω–æ**: –≠—Ç–æ **–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –æ—Ç WB API, –Ω–µ –æ—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–í—ã–≤–æ–¥**: –ù–µ–ª—å–∑—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å ROAS/ROI –¥–ª—è —ç—Ç–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ –∑–Ω–∞–Ω–∏—è "–Ω–∞—Å—Ç–æ—è—â–µ–≥–æ" spend.

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### Possible Future Investigation

**–ï—Å–ª–∏ WB –¥–æ–±–∞–≤–∏—Ç API –¥–ª—è —Å–∫–ª–µ–µ–∫**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è WB API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Ä–∞–∑ –≤ –∫–≤–∞—Ä—Ç–∞–ª)
2. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å SDK updates (`daytona-wildberries-typescript-sdk`)
3. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ WB API changelog

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö**:
1. WB Seller Portal (UI) - –º–æ–≥—É—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∫–ª–µ–π–∫–∏ –≤–∏–∑—É–∞–ª—å–Ω–æ
2. WB Support - –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Å–∫–ª–µ–µ–∫
3. Reverse engineering - –∞–Ω–∞–ª–∏–∑ WB frontend API calls (risky)

**–í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞** (workaround):
```typescript
// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –ø–æ –±—Ä–µ–Ω–¥—É/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
// –°—á–∏—Ç–∞—Ç—å "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø—ã" –≤–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
const groupedMetrics = {
  brand: 'ter',
  totalSpend: 11337,  // ter-13-1
  totalRevenue: 1105 + 1489 + 1512 + 31464,  // –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –±—Ä–µ–Ω–¥–∞
  avgROAS: totalRevenue / totalSpend
};
```

**–†–∏—Å–∫–∏ workaround**:
- –ù–µ—Ç–æ—á–Ω–∞—è –∞—Ç—Ä–∏–±—É—Ü–∏—è (—Ä–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –≤ –≥—Ä—É–ø–ø–µ)
- –ò—Å–∫–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### Backend (–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –ö–û–†–†–ï–ö–¢–ù–ê)

**‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ–º —Å–µ–π—á–∞—Å**:
1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ WB API "as-is"
2. –°–æ—Ö—Ä–∞–Ω—è–µ–º spend=0, revenue>0 –±–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π
3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–µ—Ä–µ–∑ `/v1/analytics/advertising` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**‚úÖ –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å**:
1. ‚ùå –ù–ï –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è parent_nm_id/linked_nm_ids (–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö)
2. ‚ùå –ù–ï —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞—Ç—Ä–∞—Ç—ã (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ —Å–≤—è–∑–µ–π)
3. ‚ùå –ù–ï –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å WB data (source of truth)

**‚úÖ API Response –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
```json
{
  "key": "sku:173588306",
  "label": "ter-09",
  "nmId": 173588306,
  "views": 0,
  "clicks": 0,
  "spend": 0,       // ‚Üê WB API –≤–µ—Ä–Ω—É–ª 0
  "revenue": 1105,  // ‚Üê WB API –≤–µ—Ä–Ω—É–ª 1105
  "roas": null,     // ‚Üê –ù–µ–ª—å–∑—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å (0 –≤ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ)
  "roi": null,      // ‚Üê –ù–µ–ª—å–∑—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å (0 –≤ –∑–Ω–∞–º–µ–Ω–∞—Ç–µ–ª–µ)
  "efficiency": {
    "status": "unknown",
    "recommendation": "No spend data available"
  }
}
```

### Frontend (–¢—Ä–µ–±—É–µ—Ç—Å—è —É–ª—É—á—à–µ–Ω–∏–µ UX)

**‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å**:
1. Tooltip –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º
2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–∫–æ–Ω–∫–∞ —Ä—è–¥–æ–º —Å–æ spend=0
3. –ü–æ—è—Å–Ω–µ–Ω–∏–µ –≤ UI: "–î–∞–Ω–Ω—ã–µ –æ—Ç WB API, –º–µ—Ö–∞–Ω–∏–∑–º —Å–∫–ª–µ–µ–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

**‚úÖ –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
```tsx
// –°–º. —Ä–∞–∑–¥–µ–ª "Frontend Strategy: Display As-Is + Tooltip" –≤—ã—à–µ
```

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **Request #82 (Frontend)**: `frontend/docs/request-backend/82-card-linking-product-bundles.md`
- **Request #82 Summary**: `frontend/docs/request-backend/82-SUMMARY.md`
- **Epic 33 (Advertising Analytics)**: `docs/epics/epic-33-advertising-analytics.md`
- **WB API Documentation**: https://dev.wildberries.ru/openapi/promotion
- **SDK Repository**: https://github.com/salacoste/daytona-wildberries-typescript-sdk

---

## üìû –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–î–ª—è Frontend Team**:
1. ‚úÖ –ü—Ä–æ—á–∏—Ç–∞—Ç—å backend-–æ—Ç–≤–µ—Ç (—ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å tooltip –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å EfficiencyBadge –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
4. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤ user guide

**–î–ª—è Backend Team**:
1. ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞)
2. ‚è≥ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å WB API updates (—Ä–∞–∑ –≤ –∫–≤–∞—Ä—Ç–∞–ª)
3. ‚è≥ –ï—Å–ª–∏ WB –¥–æ–±–∞–≤–∏—Ç API –¥–ª—è —Å–∫–ª–µ–µ–∫ - –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

**–î–ª—è Product Owner**:
1. ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: ROAS/ROI –Ω–µ–ª—å–∑—è —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Å spend=0
2. ‚úÖ –ö–æ–º–º—É–Ω–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —á–µ—Ä–µ–∑ UI tooltip
3. ‚è≥ –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–ø—Ä–æ—Å –∫ WB Support –æ –¥–æ—Å—Ç—É–ø–µ –∫ –¥–∞–Ω–Ω—ã–º —Å–∫–ª–µ–µ–∫ (low priority)

---

**Prepared by**: Backend Team (Claude Code Assistant)
**Reviewed**: WB API Documentation + SDK v2.3.2+
**Status**: ‚úÖ Investigation Complete - No Backend Changes Required
