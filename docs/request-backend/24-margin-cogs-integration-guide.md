# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: –ú–∞—Ä–∂–∞ –∏ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (COGS)

> **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å**: –ù–æ—è–±—Ä—å 2025 (Epic 20 + Request #15 + Story 2.7 + Story 6.1 + Story 6.3)
>
> –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç **—Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é** backend –ª–æ–≥–∏–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∞—Ä–∂–æ–π –∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å—é. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

## üÜï –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Sprint 1, –Ω–æ—è–±—Ä—å 2025)

| Feature | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|--------|----------|
| **Story 6.1** | ‚úÖ Done | Date Range Analytics: `weekStart`/`weekEnd` –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| **Story 6.3** | ‚úÖ Done | ROI & Profit Metrics: `roi`, `profit_per_unit` –≤ –æ—Ç–≤–µ—Ç–∞—Ö |
| **Story 5.1** | ‚úÖ Done | COGS History: `GET /v1/cogs/history` endpoint |

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
2. [API Endpoints](#api-endpoints)
3. [üÜï Date Range Analytics (Story 6.1)](#-date-range-analytics-story-61)
4. [üÜï ROI & Profit Metrics (Story 6.3)](#-roi--profit-metrics-story-63)
5. [–°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-–æ—Ç–≤–µ—Ç–æ–≤)
6. [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ `missing_data_reason`](#—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫-missing_data_reason)
7. [–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –Ω–µ–¥–µ–ª—å](#–ª–æ–≥–∏–∫–∞-—Ä–∞—Å—á—ë—Ç–∞-–Ω–µ–¥–µ–ª—å)
8. [–û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏ –≤ –¥–∞–Ω–Ω—ã—Ö](#–æ—Å–æ–±—ã–µ-—Å–ª—É—á–∞–∏-–≤-–¥–∞–Ω–Ω—ã—Ö)
9. [Polling –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è COGS](#polling-–ø–æ—Å–ª–µ-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è-cogs)
10. [HTTP —Å—Ç–∞—Ç—É—Å—ã –∏ –æ—à–∏–±–∫–∏](#http-—Å—Ç–∞—Ç—É—Å—ã-–∏-–æ—à–∏–±–∫–∏)
11. [Checklist –¥–ª—è Frontend](#checklist-–¥–ª—è-frontend)

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   wb_finance_raw    ‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ   weekly_margin_fact  ‚îÇ ‚îÄ‚îÄ‚îÄ‚ñ∫ ‚îÇ    API Response        ‚îÇ
‚îÇ   (—Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ     ‚îÇ      ‚îÇ   (–∞–≥—Ä–µ–≥–∞—Ü–∏—è –º–∞—Ä–∂–∏    ‚îÇ      ‚îÇ    (current_margin_*)  ‚îÇ
‚îÇ    –∏–∑ WB –æ—Ç—á—ë—Ç–æ–≤)   ‚îÇ      ‚îÇ    –ø–æ –Ω–µ–¥–µ–ª—è–º)        ‚îÇ      ‚îÇ                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                            ‚ñ≤
         ‚îÇ                            ‚îÇ
    –ò–º–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤               –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π
    WB Finance API               –ø–µ—Ä–µ—Å—á—ë—Ç –º–∞—Ä–∂–∏
    (Excel –∏–ª–∏ SDK)              –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è COGS
```

### –ö–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `wb_finance_raw` | –°—ã—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ WB –æ—Ç—á—ë—Ç–æ–≤ (40+ –ø–æ–ª–µ–π) |
| `cogs` | –í–µ—Ä—Å–∏–æ–Ω–Ω–∞—è —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (`valid_from`, `valid_to`) |
| `weekly_margin_fact` | –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–∞—Ä–∂–∞ –ø–æ SKU/–Ω–µ–¥–µ–ª–µ |
| `weekly_payout_summary` | –ù–µ–¥–µ–ª—å–Ω—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–≤–æ–¥–∫–∏ |

### –§–æ—Ä–º—É–ª—ã —Ä–∞—Å—á—ë—Ç–∞ –º–∞—Ä–∂–∏

```
gross_profit = revenue_net_rub - cogs_rub
margin_percent = (gross_profit / |revenue_net_rub|) √ó 100%
```

–ì–¥–µ:
- `revenue_net_rub` = SUM(net_for_pay) –∏–∑ `wb_finance_raw` –∑–∞ –Ω–µ–¥–µ–ª—é
- `cogs_rub` = unit_cost_rub √ó qty (—Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å √ó –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)

---

## API Endpoints

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ —Å –º–∞—Ä–∂–æ–π

```http
GET /v1/products?include_cogs=true&limit=50&cursor=...
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `include_cogs` | boolean | `true` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ä–∂–∏ (Request #15) |
| `limit` | number | –ö–æ–ª-–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ (default: 50, max: 100) |
| `cursor` | string | –ö—É—Ä—Å–æ—Ä –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ |
| `search` | string | –ü–æ–∏—Å–∫ –ø–æ –∞—Ä—Ç–∏–∫—É–ª—É/–Ω–∞–∑–≤–∞–Ω–∏—é |

**–û—Ç–≤–µ—Ç:**
```json
{
  "data": [
    {
      "nm_id": "173589742",
      "sa_name": "–¢–µ—Ä–º–æ–±–µ–ª—å–µ –∑–∏–º–Ω–µ–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –∫–æ–º–ø–ª–µ–∫—Ç",
      "brand": "–û,–î–ï–ù–¨",
      "category": "–¢–µ—Ä–º–æ–∫–æ–º–ø–ª–µ–∫—Ç—ã",

      "has_cogs": true,
      "cogs": {
        "id": "3c465193-ef1e-470b-ae21-1e1055237590",
        "unit_cost_rub": "11",
        "valid_from": "2025-11-23T00:00:00.000Z",
        "valid_to": null,
        "source": "manual",
        "created_by": "630e7720-d105-42af-8991-5ca84bb576c4",
        "created_at": "2025-11-23T15:25:53.984Z"
      },

      "current_margin_pct": 92.32,
      "current_margin_period": "2025-W44",
      "current_margin_sales_qty": 5,
      "current_margin_revenue": 1431.59,
      "missing_data_reason": null
    }
  ],
  "pagination": {
    "count": 50,
    "has_more": true,
    "next_cursor": "eyJpZCI6IjE3MzU4OTc0NCJ9"
  }
}
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞

```http
GET /v1/products/{nmId}
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
```

**–û—Ç–≤–µ—Ç:** –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞ (—Å–º. –≤—ã—à–µ) + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è WB API (photos, dimensions, characteristics).

---

### 3. SKU-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –Ω–µ–¥–µ–ª—é (+ Story 6.1, 6.3)

```http
# –û–¥–Ω–∞ –Ω–µ–¥–µ–ª—è
GET /v1/analytics/weekly/by-sku?week=2025-W44&includeCogs=true&limit=1000
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}

# Date Range (Story 6.1) - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–¥–µ–ª—å
GET /v1/analytics/weekly/by-sku?weekStart=2025-W40&weekEnd=2025-W47&includeCogs=true&limit=1000
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|----------|
| `week` | string | –û–¥–Ω–∞ –Ω–µ–¥–µ–ª—è (—Ñ–æ—Ä–º–∞—Ç YYYY-Www) |
| `weekStart` | string | üÜï **Story 6.1**: –ù–∞—á–∞–ª–æ –ø–µ—Ä–∏–æ–¥–∞ (—Ñ–æ—Ä–º–∞—Ç YYYY-Www) |
| `weekEnd` | string | üÜï **Story 6.1**: –ö–æ–Ω–µ—Ü –ø–µ—Ä–∏–æ–¥–∞ (max 52 –Ω–µ–¥–µ–ª–∏) |
| `includeCogs` | boolean | –í–∫–ª—é—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –º–∞—Ä–∂–µ (default: false) |
| `limit` | number | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ SKU (default: 100, max: 1000) |

**–í–∞–∂–Ω–æ:**
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—è–Ω–≤–∞—Ä—å 2025) endpoint –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç **–í–°–ï** SKU, –∏—Å–ø–æ–ª—å–∑—É—è SQL `GROUP BY`
- –ü—Ä–∏ `weekStart`/`weekEnd` –¥–∞–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è: SUM –¥–ª—è qty/revenue/cogs, weighted AVG –¥–ª—è margin%

**–û—Ç–≤–µ—Ç (—Å Story 6.3 ROI –ø–æ–ª—è–º–∏):**
```json
{
  "data": [
    {
      "id": "173589742",
      "nm_id": "173589742",
      "sa_name": "ter-11",
      "sale_dt": "2025-10-28T12:21:18.000Z",
      "total_units": 5,
      "revenue_gross": 1448.00,
      "revenue_net": 1431.59,
      "logistics_cost": 176.50,
      "storage_cost": 0,
      "penalties": 0,
      "cogs": 110.00,
      "profit": 1321.59,
      "margin_pct": 92.32,
      "roi": 1201.45,
      "profit_per_unit": 264.32,
      "missing_cogs_flag": false
    }
  ],
  "pagination": {
    "count": 20,
    "has_more": false,
    "next_cursor": null
  }
}
```

---

### 4. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (–æ–¥–∏–Ω–æ—á–Ω–æ–µ)

```http
POST /v1/products/{nmId}/cogs
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
Content-Type: application/json

{
  "unit_cost_rub": 11.00,
  "valid_from": "2025-11-23",
  "currency": "RUB",
  "notes": "–ó–∞–∫—É–ø–∫–∞ –ø–∞—Ä—Ç–∏–∏ #123"
}
```

**–ü–æ–ª—è –∑–∞–ø—Ä–æ—Å–∞:**
| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|-------------|----------|
| `unit_cost_rub` | number | ‚úÖ | –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –µ–¥–∏–Ω–∏—Ü—ã (>0) |
| `valid_from` | string | ‚ùå | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è (default: —Å–µ–≥–æ–¥–Ω—è) |
| `currency` | string | ‚ùå | –í–∞–ª—é—Ç–∞: RUB, USD, EUR, CNY (default: RUB) |
| `notes` | string | ‚ùå | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |

**–û—Ç–≤–µ—Ç 201 Created:**
```json
{
  "nm_id": "173589742",
  "sa_name": "–¢–µ—Ä–º–æ–±–µ–ª—å–µ –∑–∏–º–Ω–µ–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –∫–æ–º–ø–ª–µ–∫—Ç",
  "has_cogs": true,
  "cogs": {
    "id": "3c465193-ef1e-470b-ae21-1e1055237590",
    "unit_cost_rub": "11",
    "valid_from": "2025-11-23T00:00:00.000Z",
    "source": "manual"
  },
  "current_margin_pct": null,
  "current_margin_period": "2025-W47",
  "missing_data_reason": "CALCULATION_PENDING"
}
```

**Epic 20:** –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è COGS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç –º–∞—Ä–∂–∏ (5-30 —Å–µ–∫).

---

### 5. –ú–∞—Å—Å–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏

```http
POST /v1/products/cogs/bulk
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
Content-Type: application/json

{
  "items": [
    { "nm_id": "173589742", "unit_cost_rub": 11.00 },
    { "nm_id": "173589743", "unit_cost_rub": 25.50 },
    { "nm_id": "999999999", "unit_cost_rub": 100.00 }
  ],
  "valid_from": "2025-11-23"
}
```

**–û—Ç–≤–µ—Ç 202 Accepted:**
```json
{
  "accepted": 2,
  "failed": 1,
  "results": [
    { "nm_id": "173589742", "status": "created", "cogs_id": "uuid-1" },
    { "nm_id": "173589743", "status": "created", "cogs_id": "uuid-2" },
    { "nm_id": "999999999", "status": "failed", "error": "Product not found" }
  ],
  "margin_calculation_triggered": true
}
```

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- –î–æ 1000 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å
- Batch –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –Ω–∞ –ø–µ—Ä–µ—Å—á—ë—Ç –≤–º–µ—Å—Ç–æ N (Epic 20)
- –í—Ä–µ–º—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –º–∞—Ä–∂–∏: ~45-60 —Å–µ–∫ –¥–ª—è 500 —Ç–æ–≤–∞—Ä–æ–≤

---

### 6. –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–¥–∞–∂ —Ç–æ–≤–∞—Ä–∞ –ø–æ –Ω–µ–¥–µ–ª—è–º (Story 23.8)

```http
GET /v1/analytics/weekly/product-weeks?nm_id={nm_id}&weeks=13
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|-------------|----------|
| `nm_id` | string | ‚úÖ | –ê—Ä—Ç–∏–∫—É–ª —Ç–æ–≤–∞—Ä–∞ |
| `weeks` | number | ‚ùå | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–¥–µ–ª—å (1-52, default: 13) |

**–û—Ç–≤–µ—Ç 200 OK:**
```json
{
  "nm_id": "173589742",
  "sa_name": "–¢–µ—Ä–º–æ–±–µ–ª—å–µ –∑–∏–º–Ω–µ–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–µ –∫–æ–º–ø–ª–µ–∫—Ç",
  "weeks_with_sales": [
    {
      "week": "2025-W44",
      "week_start_date": "2025-10-28",
      "sales_qty": 5,
      "revenue_net": 1431.59,
      "has_margin": true,
      "margin_pct": 92.32
    },
    {
      "week": "2025-W43",
      "week_start_date": "2025-10-21",
      "sales_qty": 3,
      "revenue_net": 892.47,
      "has_margin": true,
      "margin_pct": 91.85
    },
    {
      "week": "2025-W42",
      "week_start_date": "2025-10-14",
      "sales_qty": 0,
      "revenue_net": 0,
      "has_margin": false,
      "margin_pct": null
    }
  ],
  "summary": {
    "total_weeks_analyzed": 13,
    "weeks_with_sales": 8,
    "weeks_with_margin": 6,
    "total_sales_qty": 42,
    "total_revenue_net": 12500.50
  }
}
```

**Use Cases (Frontend Level 2/3):**
- **–°—Ü–µ–Ω–∞—Ä–∏–π B** (NO_SALES_DATA): –ü–æ–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–¥–∞–∂ –∑–∞ –¥—Ä—É–≥–∏–µ –Ω–µ–¥–µ–ª–∏
- **Margin Trend Chart**: –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –º–∞—Ä–∂–∏
- **Product Summary**: –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- p95 < 200ms –¥–ª—è 52 –Ω–µ–¥–µ–ª—å
- SQL —Å CTE-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π –∏ JOIN –Ω–∞ `weekly_margin_fact`

---

## üÜï Date Range Analytics (Story 6.1)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–æ—è–±—Ä—å 2025)

Story 6.1 –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É **multi-week aggregation** –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoints. –í–º–µ—Å—Ç–æ –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–æ–π –Ω–µ–¥–µ–ª–∏ —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –ø–æ–ª—É—á–∏—Ç—å –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ endpoints

| Endpoint | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã | –ê–≥—Ä–µ–≥–∞—Ü–∏—è |
|----------|-----------|-----------|
| `/v1/analytics/weekly/by-sku` | `weekStart`, `weekEnd` | SUM(qty, revenue, cogs, profit), weighted AVG(margin) |
| `/v1/analytics/weekly/by-brand` | `weekStart`, `weekEnd` | SUM –ø–æ –±—Ä–µ–Ω–¥—É |
| `/v1/analytics/weekly/by-category` | `weekStart`, `weekEnd` | SUM –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```http
# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ SKU –∑–∞ 8 –Ω–µ–¥–µ–ª—å
GET /v1/analytics/weekly/by-sku?weekStart=2025-W40&weekEnd=2025-W47&includeCogs=true
Authorization: Bearer {jwt_token}
X-Cabinet-Id: {cabinet_id}

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –±—Ä–µ–Ω–¥–∞–º –∑–∞ –∫–≤–∞—Ä—Ç–∞–ª
GET /v1/analytics/weekly/by-brand?weekStart=2025-W35&weekEnd=2025-W47&includeCogs=true

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∑–∞ –º–µ—Å—è—Ü
GET /v1/analytics/weekly/by-category?weekStart=2025-W44&weekEnd=2025-W47&includeCogs=true
```

### –õ–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏

```
–ü—Ä–∏ multi-week –∑–∞–ø—Ä–æ—Å–µ:
- total_units = SUM(total_units) –ø–æ –Ω–µ–¥–µ–ª—è–º
- revenue_net = SUM(revenue_net) –ø–æ –Ω–µ–¥–µ–ª—è–º
- cogs = SUM(cogs) –ø–æ –Ω–µ–¥–µ–ª—è–º
- profit = SUM(profit) –ø–æ –Ω–µ–¥–µ–ª—è–º
- margin_pct = SUM(profit) / SUM(revenue_net) √ó 100%  (weighted average)
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è

| –ü—Ä–∞–≤–∏–ª–æ | –û—Ç–≤–µ—Ç –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ |
|---------|---------------------|
| `weekEnd >= weekStart` | 400 VALIDATION_ERROR |
| –î–∏–∞–ø–∞–∑–æ–Ω ‚â§ 52 –Ω–µ–¥–µ–ª—å | 400 VALIDATION_ERROR |
| –§–æ—Ä–º–∞—Ç YYYY-Www | 400 INVALID_WEEK_FORMAT |

### Frontend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
// TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è date range –∑–∞–ø—Ä–æ—Å–∞
interface DateRangeQuery {
  weekStart: string;  // "2025-W40"
  weekEnd: string;    // "2025-W47"
  includeCogs?: boolean;
  limit?: number;
}

// –ü—Ä–∏–º–µ—Ä fetch
const fetchDateRangeAnalytics = async (query: DateRangeQuery) => {
  const params = new URLSearchParams({
    weekStart: query.weekStart,
    weekEnd: query.weekEnd,
    includeCogs: String(query.includeCogs ?? true),
    limit: String(query.limit ?? 100)
  });

  const response = await fetch(`/v1/analytics/weekly/by-sku?${params}`, {
    headers: {
      'Authorization': `Bearer ${token}`,
      'X-Cabinet-Id': cabinetId
    }
  });
  return response.json();
};
```

---

## üÜï ROI & Profit Metrics (Story 6.3)

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–Ω–æ—è–±—Ä—å 2025)

Story 6.3 –¥–æ–±–∞–≤–ª—è–µ—Ç **ROI** (Return on Investment) –∏ **Profit per Unit** –≤ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–≤–µ—Ç—ã.

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö

| –ü–æ–ª–µ | –¢–∏–ø | –§–æ—Ä–º—É–ª–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|---------|----------|
| `roi` | `number \| null` | `(profit / cogs) √ó 100%` | –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ |
| `profit_per_unit` | `number \| null` | `profit / total_units` | –ü—Ä–∏–±—ã–ª—å –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ |

### –ö–æ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `null`

| –ü–æ–ª–µ | null –∫–æ–≥–¥–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|------|-----------|---------|
| `roi` | `cogs = 0` –∏–ª–∏ `cogs = null` | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å |
| `profit_per_unit` | `total_units = 0` | –î–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å |

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (–ø—Ä–∏–º–µ—Ä)

```json
{
  "data": [
    {
      "nm_id": "173589742",
      "sa_name": "ter-11",
      "total_units": 25,
      "revenue_gross": 7500.00,
      "revenue_net": 7250.00,
      "cogs": 550.00,
      "profit": 6700.00,
      "margin_pct": 92.41,

      "roi": 1218.18,
      "profit_per_unit": 268.00
    }
  ]
}
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è ROI

| ROI | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----|----------|
| `roi > 100%` | –ü—Ä–∏–±—ã–ª—å > —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—Ö–æ—Ä–æ—à–æ) |
| `roi = 100%` | –ü—Ä–∏–±—ã–ª—å = —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—Ç–æ—á–∫–∞ –±–µ–∑—É–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏) |
| `roi < 100%` | –ü—Ä–∏–±—ã–ª—å < —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ (—É–±—ã—Ç–æ—á–Ω–æ) |
| `roi = null` | COGS –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω –∏–ª–∏ = 0 |

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è UI

```typescript
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ROI
function formatROI(roi: number | null): string {
  if (roi === null) return '‚Äî';
  return `${roi.toFixed(2)}%`;
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ profit per unit
function formatProfitPerUnit(value: number | null): string {
  if (value === null) return '‚Äî';
  return `${value.toFixed(2)} ‚ÇΩ`;
}

// –¶–≤–µ—Ç –¥–ª—è ROI
function getROIColor(roi: number | null): string {
  if (roi === null) return 'gray';
  if (roi >= 150) return 'green';
  if (roi >= 100) return 'yellow';
  return 'red';
}
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ endpoints

ROI –∏ profit_per_unit –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Å–µ—Ö –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö endpoints:

| Endpoint | ROI | Profit per Unit |
|----------|-----|-----------------|
| `/v1/analytics/weekly/by-sku` | ‚úÖ | ‚úÖ |
| `/v1/analytics/weekly/by-brand` | ‚úÖ | ‚úÖ |
| `/v1/analytics/weekly/by-category` | ‚úÖ | ‚úÖ |
| `/v1/analytics/weekly/margin-trends` | ‚úÖ | ‚úÖ |

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `includeCogs=true` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç—Ç–∏—Ö –ø–æ–ª–µ–π.

---

## –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π A: ‚úÖ –ü–æ–ª–Ω—ã–π —É—Å–ø–µ—Ö (COGS + –ø—Ä–æ–¥–∞–∂–∏ + –º–∞—Ä–∂–∞)

**–£—Å–ª–æ–≤–∏—è:** COGS –Ω–∞–∑–Ω–∞—á–µ–Ω–∞, –µ—Å—Ç—å –ø—Ä–æ–¥–∞–∂–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é, –º–∞—Ä–∂–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞.

```json
{
  "nm_id": "173589742",
  "has_cogs": true,
  "cogs": {
    "unit_cost_rub": "11",
    "valid_from": "2025-11-23T00:00:00.000Z",
    "source": "manual"
  },
  "current_margin_pct": 92.32,
  "current_margin_period": "2025-W44",
  "current_margin_sales_qty": 5,
  "current_margin_revenue": 1431.59,
  "missing_data_reason": null
}
```

**Frontend:** –ü–æ–∫–∞–∑–∞—Ç—å –º–∞—Ä–∂—É `92.32%` —Å –ø–æ–¥–ø–∏—Å—å—é "W44"

---

### –°—Ü–µ–Ω–∞—Ä–∏–π B: ‚ö†Ô∏è COGS –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é

**–£—Å–ª–æ–≤–∏—è:** COGS –Ω–∞–∑–Ω–∞—á–µ–Ω–∞, –Ω–æ –∑–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—É—é –Ω–µ–¥–µ–ª—é —É —Ç–æ–≤–∞—Ä–∞ –Ω–µ—Ç —Å—Ç—Ä–æ–∫ —Å `qty=1`.

```json
{
  "nm_id": "173589742",
  "has_cogs": true,
  "cogs": {
    "unit_cost_rub": "11",
    "valid_from": "2025-11-23T00:00:00.000Z"
  },
  "current_margin_pct": null,
  "current_margin_period": "2025-W47",
  "current_margin_sales_qty": 0,
  "current_margin_revenue": null,
  "missing_data_reason": "NO_SALES_DATA"
}
```

**Frontend:** "–ù–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ W47" + –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏–µ –Ω–µ–¥–µ–ª–∏

---

### –°—Ü–µ–Ω–∞—Ä–∏–π C: ‚ùå –ù–ï–¢ COGS, –µ—Å—Ç—å –ø—Ä–æ–¥–∞–∂–∏

**–£—Å–ª–æ–≤–∏—è:** –¢–æ–≤–∞—Ä –ø—Ä–æ–¥–∞–≤–∞–ª—Å—è, –Ω–æ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞.

```json
{
  "nm_id": "173589742",
  "has_cogs": false,
  "cogs": null,
  "current_margin_pct": null,
  "current_margin_period": "2025-W47",
  "current_margin_sales_qty": 15,
  "current_margin_revenue": 4500.00,
  "missing_data_reason": "COGS_NOT_ASSIGNED"
}
```

**Frontend:** –ü–æ–∫–∞–∑–∞—Ç—å "–ù–∞–∑–Ω–∞—á—å—Ç–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å" (–∫–Ω–æ–ø–∫–∞) + –≤—ã—Ä—É—á–∫—É `4500 ‚ÇΩ`

---

### –°—Ü–µ–Ω–∞—Ä–∏–π D: ‚ùå –ù–ï–¢ COGS, –ù–ï–¢ –ø—Ä–æ–¥–∞–∂

**–£—Å–ª–æ–≤–∏—è:** –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂.

```json
{
  "nm_id": "999999999",
  "has_cogs": false,
  "cogs": null,
  "current_margin_pct": null,
  "current_margin_period": null,
  "current_margin_sales_qty": 0,
  "current_margin_revenue": null,
  "missing_data_reason": "NO_SALES_DATA"
}
```

**Frontend:** "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö"

---

### –°—Ü–µ–Ω–∞—Ä–∏–π E: ‚è≥ COGS —Ç–æ–ª—å–∫–æ —á—Ç–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞, –º–∞—Ä–∂–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è

**–£—Å–ª–æ–≤–∏—è:** –°—Ä–∞–∑—É –ø–æ—Å–ª–µ POST /cogs, worker –µ—â—ë –Ω–µ —É—Å–ø–µ–ª –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å.

```json
{
  "nm_id": "173589742",
  "has_cogs": true,
  "cogs": {
    "unit_cost_rub": "11",
    "valid_from": "2025-11-26T00:00:00.000Z"
  },
  "current_margin_pct": null,
  "current_margin_period": "2025-W47",
  "current_margin_sales_qty": 15,
  "current_margin_revenue": 4500.00,
  "missing_data_reason": "CALCULATION_PENDING"
}
```

**Frontend:** –ü–æ–∫–∞–∑–∞—Ç—å "(—Ä–∞—Å—á—ë—Ç –º–∞—Ä–∂–∏...)" + polling –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫

---

## –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ `missing_data_reason`

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ Frontend |
|----------|----------|-------------------|
| `null` | –ú–∞—Ä–∂–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ | –ü–æ–∫–∞–∑–∞—Ç—å `current_margin_pct` |
| `"NO_SALES_DATA"` | –ù–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ –ø–µ—Ä–∏–æ–¥ | "–ù–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ {period}" |
| `"COGS_NOT_ASSIGNED"` | COGS –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ | "–ù–∞–∑–Ω–∞—á—å—Ç–µ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å" |
| `"CALCULATION_PENDING"` | –†–∞—Å—á—ë—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ | Spinner + polling |
| `"INCOMPLETE_WEEK"` | –ù–µ–¥–µ–ª—è –µ—â—ë –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | "–î–∞–Ω–Ω—ã–µ –∑–∞ {period} –µ—â—ë –Ω–µ –≥–æ—Ç–æ–≤—ã" |

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è `missing_data_reason`

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                 ‚îÇ
‚îÇ  1. –ü–æ–ª—É—á–∏—Ç—å lastCompletedWeek (W47 –¥–ª—è —Å—Ä–µ–¥—ã W48)             ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  2. –ï—Å—Ç—å margin_fact –¥–ª—è —ç—Ç–æ–π –Ω–µ–¥–µ–ª–∏?                          ‚îÇ
‚îÇ     ‚îú‚îÄ –î–ê ‚Üí margin_pct = –∑–Ω–∞—á–µ–Ω–∏–µ, missing_data_reason = null  ‚îÇ
‚îÇ     ‚îî‚îÄ –ù–ï–¢ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—á–µ–º—É:                                 ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  3. –ï—Å—Ç—å –ª–∏ –ø—Ä–æ–¥–∞–∂–∏ (wb_finance_raw) –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é?            ‚îÇ
‚îÇ     ‚îú‚îÄ –ù–ï–¢ ‚Üí missing_data_reason = "NO_SALES_DATA"             ‚îÇ
‚îÇ     ‚îî‚îÄ –î–ê ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å COGS:                                    ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  4. –ï—Å—Ç—å –ª–∏ COGS –¥–ª—è —Ç–æ–≤–∞—Ä–∞ (–¥–µ–π—Å—Ç–≤—É—é—â–∏–π –Ω–∞ –¥–∞—Ç—É –Ω–µ–¥–µ–ª–∏)?      ‚îÇ
‚îÇ     ‚îú‚îÄ –ù–ï–¢ ‚Üí missing_data_reason = "COGS_NOT_ASSIGNED"         ‚îÇ
‚îÇ     ‚îî‚îÄ –î–ê ‚Üí missing_data_reason = "CALCULATION_PENDING"        ‚îÇ
‚îÇ             (–º–∞—Ä–∂–∞ –µ—â—ë –Ω–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞)                          ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –Ω–µ–¥–µ–ª—å

### –ö–∞–∫–∞—è –Ω–µ–¥–µ–ª—è —Å—á–∏—Ç–∞–µ—Ç—Å—è "–ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π"

Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `IsoWeekService.getLastCompletedWeek(conservative: true)` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–µ–¥–µ–ª–∏ —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ WB.

| –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (Moscow) | –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è –Ω–µ–¥–µ–ª—è |
|---------------------|------------------------------|
| –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫         | W-2 (2 –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥)         |
| –í—Ç–æ—Ä–Ω–∏–∫ –¥–æ 12:00    | W-2                          |
| –í—Ç–æ—Ä–Ω–∏–∫ –ø–æ—Å–ª–µ 12:00 | W-1 (–ø—Ä–æ—à–ª–∞—è –Ω–µ–¥–µ–ª—è)         |
| –°—Ä–µ–¥–∞ - –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ | W-1                          |

**–ü–æ—á–µ–º—É:** WB –ø—É–±–ª–∏–∫—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞ –Ω–µ–¥–µ–ª—é –≤–æ –≤—Ç–æ—Ä–Ω–∏–∫ ~10:00 MSK. –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º –∂–¥—ë—Ç –¥–æ 12:00.

**–ü—Ä–∏–º–µ—Ä (—Å–µ–≥–æ–¥–Ω—è —Å—Ä–µ–¥–∞ 26.11.2025, W48):**
- –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω–∞—è = W47 (17-23 –Ω–æ—è–±—Ä—è)
- –ú–∞—Ä–∂–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞ W47

### –§–æ—Ä–º–∞—Ç ISO –Ω–µ–¥–µ–ª–∏

```
2025-W47
‚îÇ    ‚îÇ
‚îÇ    ‚îî‚îÄ –ù–æ–º–µ—Ä –Ω–µ–¥–µ–ª–∏ (01-53)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –ì–æ–¥
```

**–ì—Ä–∞–Ω–∏—Ü—ã –Ω–µ–¥–µ–ª–∏:**
- –ù–∞—á–∞–ª–æ: –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ 00:00:00 MSK
- –ö–æ–Ω–µ—Ü: –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ 23:59:59 MSK

---

## –û—Å–æ–±—ã–µ —Å–ª—É—á–∞–∏ –≤ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä–æ–∫–∏ —Å `qty=2` (—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –≤–æ–∑–º–µ—â–µ–Ω–∏—è)

```json
{
  "nm_id": "173589742",
  "qty": 2,
  "net_for_pay": 0,
  "doc_type": null
}
```

- **–ù–ï —è–≤–ª—è—é—Ç—Å—è –ø—Ä–æ–¥–∞–∂–∞–º–∏** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
- **–ù–ï —Å–æ–∑–¥–∞—é—Ç** –∑–∞–ø–∏—Å–∏ –≤ `weekly_margin_fact`
- –ï—Å–ª–∏ –∑–∞ –Ω–µ–¥–µ–ª—é –±—ã–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–∞–∫–∏–µ —Å—Ç—Ä–æ–∫–∏ ‚Üí `missing_data_reason: "NO_SALES_DATA"`

### –°—Ç—Ä–æ–∫–∏ —Å `qty=0` (—É—Å–ª—É–≥–∏)

–õ–æ–≥–∏—Å—Ç–∏–∫–∞, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —à—Ç—Ä–∞—Ñ—ã. –ù–µ –≤–ª–∏—è—é—Ç –Ω–∞ –º–∞—Ä–∂—É —Ç–æ–≤–∞—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é.

### –°—Ç—Ä–æ–∫–∏ —Å `qty=1` (–ø—Ä–æ–¥–∞–∂–∏/–≤–æ–∑–≤—Ä–∞—Ç—ã)

**–¢–æ–ª—å–∫–æ —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –º–∞—Ä–∂–∏:**
- `doc_type: "sale"` ‚Üí –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞
- `doc_type: "return"` ‚Üí –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –≤—ã—Ä—É—á–∫–∞ (—Å—Ç–æ—Ä–Ω–æ)

---

## Polling –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è COGS

–ü–æ—Å–ª–µ `POST /v1/products/{nmId}/cogs` –º–∞—Ä–∂–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** —á–µ—Ä–µ–∑ BullMQ worker.

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è polling

```javascript
const assignCogs = async (nmId, unitCost) => {
  // 1. –ù–∞–∑–Ω–∞—á–∏—Ç—å COGS
  await api.post(`/products/${nmId}/cogs`, { unit_cost_rub: unitCost });

  // 2. –ù–∞—á–∞—Ç—å polling
  let attempts = 0;
  const maxAttempts = 10;
  const interval = 3000; // 3 —Å–µ–∫—É–Ω–¥—ã

  const poll = async () => {
    const product = await api.get(`/products/${nmId}`);

    // –ú–∞—Ä–∂–∞ –≥–æ—Ç–æ–≤–∞?
    if (product.current_margin_pct !== null) {
      return product;
    }

    // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å polling
    if (++attempts < maxAttempts) {
      await sleep(interval);
      return poll();
    }

    // –¢–∞–π–º–∞—É—Ç - –≤–µ—Ä–Ω—É—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    return product;
  };

  return poll();
};
```

### –¢–∞–π–º–∏–Ω–≥–∏

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è –ø–µ—Ä–µ—Å—á—ë—Ç–∞ –º–∞—Ä–∂–∏ |
|----------|----------------------|
| –û–¥–∏–Ω —Ç–æ–≤–∞—Ä (—Ç–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è) | 5-10 —Å–µ–∫ |
| –û–¥–∏–Ω —Ç–æ–≤–∞—Ä (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π COGS, 7 –Ω–µ–¥–µ–ª—å) | 20-30 —Å–µ–∫ |
| Bulk (500 —Ç–æ–≤–∞—Ä–æ–≤) | 45-60 —Å–µ–∫ |

---

## HTTP —Å—Ç–∞—Ç—É—Å—ã –∏ –æ—à–∏–±–∫–∏

### –£—Å–ø–µ—à–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

| Endpoint | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------|----------|
| GET /products | 200 | –£—Å–ø–µ—Ö |
| GET /products/{id} | 200 | –¢–æ–≤–∞—Ä –Ω–∞–π–¥–µ–Ω |
| POST /products/{id}/cogs | 201 | COGS —Å–æ–∑–¥–∞–Ω–∞ |
| POST /products/{id}/cogs | 200 | COGS –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (—Ç–∞ –∂–µ –¥–∞—Ç–∞) |
| POST /products/cogs/bulk | 202 | –ü—Ä–∏–Ω—è—Ç–æ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É |
| GET /analytics/weekly/by-sku | 200 | –£—Å–ø–µ—Ö |

### –û—à–∏–±–∫–∏

| –°—Ç–∞—Ç—É—Å | –ö–æ–¥ –æ—à–∏–±–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------------|----------|
| 400 | VALIDATION_ERROR | –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (unit_cost_rub <= 0) |
| 400 | INVALID_WEEK_FORMAT | –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –Ω–µ–¥–µ–ª–∏ |
| 401 | UNAUTHORIZED | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JWT |
| 403 | FORBIDDEN | –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–±–∏–Ω–µ—Ç—É |
| 404 | PRODUCT_NOT_FOUND | –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–∞–±–∏–Ω–µ—Ç–µ |
| 404 | NO_DATA_FOR_WEEK | –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –Ω–µ–¥–µ–ª—é |

### –§–æ—Ä–º–∞—Ç –æ—à–∏–±–∫–∏

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid COGS data",
    "details": [
      {
        "field": "unit_cost_rub",
        "issue": "must be positive number",
        "value": -5
      }
    ],
    "trace_id": "abc-123-xyz"
  }
}
```

---

## Checklist –¥–ª—è Frontend

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

- [ ] –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å `X-Cabinet-Id` –≤–æ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `includeCogs=true` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞—Ä–∂–∏ –≤ —Å–ø–∏—Å–∫–µ
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è `missing_data_reason`
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å `current_margin_period` (–∑–∞ –∫–∞–∫—É—é –Ω–µ–¥–µ–ª—é –º–∞—Ä–∂–∞)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å polling –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è COGS (3 —Å–µ–∫ √ó 10 –ø–æ–ø—ã—Ç–æ–∫)

### üÜï Story 6.1 & 6.3 (Sprint 1)

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤—ã–±–æ—Ä –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –Ω–µ–¥–µ–ª—å (`weekStart`/`weekEnd`)
- [ ] –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å `roi` —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π (>150% –∑–µ–ª—ë–Ω—ã–π, <100% –∫—Ä–∞—Å–Ω—ã–π)
- [ ] –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å `profit_per_unit` —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–∞–ª—é—Ç—ã
- [ ] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `null` –¥–ª—è ROI/profit_per_unit (–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å "‚Äî")
- [ ] –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω: weekEnd >= weekStart, max 52 –Ω–µ–¥–µ–ª–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è

- [ ] –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤—ã–±–æ—Ä –Ω–µ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–π –º–∞—Ä–∂–∏
- [ ] –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å `current_margin_revenue` –∫–æ–≥–¥–∞ –º–∞—Ä–∂–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] –î–ª—è bulk –æ–ø–µ—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/cogs/bulk` (–¥–æ 1000 —Ç–æ–≤–∞—Ä–æ–≤)
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (invalidate –ø–æ—Å–ª–µ COGS assignment)
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Date Range –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ —Ç—Ä–µ–Ω–¥–æ–≤

### UI –°–æ—Å—Ç–æ—è–Ω–∏—è

| –°–æ—Å—Ç–æ—è–Ω–∏–µ | UI Element |
|-----------|------------|
| –ú–∞—Ä–∂–∞ –µ—Å—Ç—å | `92.32%` (–∑–µ–ª—ë–Ω—ã–π badge) |
| –ù–µ—Ç –ø—Ä–æ–¥–∞–∂ | "–ù–µ—Ç –ø—Ä–æ–¥–∞–∂ –∑–∞ W47" (—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç) |
| –ù–µ—Ç COGS | "–ù–∞–∑–Ω–∞—á–∏—Ç—å —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å" (–∫–Ω–æ–ø–∫–∞) |
| –†–∞—Å—á—ë—Ç | Spinner + "(—Ä–∞—Å—á—ë—Ç –º–∞—Ä–∂–∏...)" |
| –û—à–∏–±–∫–∞ | "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏" (–∫—Ä–∞—Å–Ω—ã–π) |

---

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ UI

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –¢–æ–≤–∞—Ä: –¢–µ—Ä–º–æ–±–µ–ª—å–µ –∑–∏–º–Ω–µ–µ (173589742)                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                             ‚îÇ
‚îÇ  –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å: 11.00 ‚ÇΩ  [–ò–∑–º–µ–Ω–∏—Ç—å]                        ‚îÇ
‚îÇ  (–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å 23.11.2025)                                   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  –ú–∞—Ä–∂–∞ –∑–∞ W44: 92.32%                               ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  –í—ã—Ä—É—á–∫–∞: 1 431.59 ‚ÇΩ | –ü—Ä–∏–±—ã–ª—å: 1 321.59 ‚ÇΩ         ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  –ü—Ä–æ–¥–∞–∂–∏: 5 —à—Ç                                      ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  ‚ö†Ô∏è W47: –ù–µ—Ç –ø—Ä–æ–¥–∞–∂ (—Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)         ‚îÇ
‚îÇ  [–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–æ–¥–∞–∂]                               ‚îÇ
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üÜï Sprint 1 Stories (–Ω–æ—è–±—Ä—å 2025)

- **Story 5.1**: [COGS History](../../../docs/stories/epic-5/story-5.1-view-cogs-history.md) - –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π COGS
- **Story 6.1**: [Date Range Analytics](../../../docs/stories/epic-6/story-6.1-date-range-analytics.md) - Multi-week –∑–∞–ø—Ä–æ—Å—ã
- **Story 6.3**: [ROI & Profit Metrics](../../../docs/stories/epic-6/story-6.3-roi-profit-metrics.md) - ROI –∏ profit_per_unit

### Epics

- **Epic 5**: [docs/stories/epic-5/](../../../docs/stories/epic-5/) - COGS History Management
- **Epic 6**: [docs/stories/epic-6/](../../../docs/stories/epic-6/) - Advanced Analytics
- **Epic 17**: [docs/stories/epic-17/](../../../docs/stories/epic-17/) - COGS & Margin Analytics
- **Epic 18**: [docs/stories/epic-18/](../../../docs/stories/epic-18/) - Products API Enhancement
- **Epic 19**: [docs/stories/epic-19/](../../../docs/stories/epic-19/) - WB Completed Weeks Only
- **Epic 20**: [docs/stories/epic-20/](../../../docs/stories/epic-20/) - Auto Margin Recalculation

### Other References

- **Request #15**: Products List Margin Enrichment (`includeCogs` parameter)
- **Products API Guide**: [docs/PRODUCTS-API-GUIDE.md](../../../docs/PRODUCTS-API-GUIDE.md)
- **API Paths Reference**: [docs/API-PATHS-REFERENCE.md](../../../docs/API-PATHS-REFERENCE.md)
- **Roadmap Doc #27**: [27-cogs-history-and-advanced-analytics-roadmap-backend.md](./27-cogs-history-and-advanced-analytics-roadmap-backend.md)

---

> **–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-11-26 (Sprint 1: Stories 5.1, 6.1, 6.3)
>
> –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ backend –æ–±–Ω–æ–≤–∏—Ç–µ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∏ —É–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –≤ —à–∞–ø–∫–µ.
