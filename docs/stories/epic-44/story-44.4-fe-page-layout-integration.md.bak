# Story 44.4: Page Layout & Navigation Integration

**Epic**: 44 - Price Calculator UI (Frontend)
**Status**: Review
**Priority**: P0 - CRITICAL
**Effort**: 2 SP
**Depends On**: Stories 44.1, 44.2, 44.3 ✅

---

## User Story

**As a** Seller,
**I want** to access the Price Calculator from the main app,
**So that** I can easily calculate prices without leaving the application.

**Non-goals**:
- Form component (separate story)
- Results component (separate story)
- Real-time calculation (separate story)

---

## Acceptance Criteria

### AC1: Page Route
- [x] Create `/cogs/price-calculator` route (existing COGS section)
- [x] Page accessible from authenticated routes only
- [x] Redirect to login if not authenticated

### AC2: Page Layout
- [x] Use existing dashboard layout with Sidebar
- [x] Page title: "Price Calculator"
- [x] Breadcrumb navigation: COGS Management > Price Calculator
- [x] Responsive two-column layout (form left, results right on desktop)

### AC3: Navigation Integration
- [x] Add "Price Calculator" link to Sidebar (COGS section)
- [x] Icon: `DollarSign` (Calculator icon already used for Unit Economics)
- [x] Position: After "COGS Management" link

### AC4: Responsive Layout
- [x] Desktop (≥1024px): Two columns (form | results)
- [x] Tablet (768-1023px): Stacked with form above results
- [x] Mobile (<768px): Single column, full-width inputs

### AC5: SEO & Metadata
- [x] Page title: "Price Calculator - WB Repricer"
- [x] Meta description: "Calculate optimal selling price for Wildberries products"

---

## Context & References

- **Parent Epic**: `docs/epics/epic-44-price-calculator-ui.md`
- **Story 44.2**: `docs/stories/epic-44/story-44.2-fe-input-form-component.md`
- **Story 44.3**: `docs/stories/epic-44/story-44.3-fe-results-display-component.md`
- **Existing Layout**: `src/app/(dashboard)/layout.tsx`

---

## Implementation Notes

### File Structure

```
src/
└── app/
    └── (dashboard)/
        └── cogs/
            └── price-calculator/
                └── page.tsx                    # Main calculator page
```

### Page Component Structure

```typescript
// src/app/(dashboard)/cogs/price-calculator/page.tsx
import { PriceCalculatorForm } from '@/components/custom/price-calculator/PriceCalculatorForm';
import { PriceCalculatorResults } from '@/components/custom/price-calculator/PriceCalculatorResults';
import { usePriceCalculator } from '@/hooks/usePriceCalculator';

export default function PriceCalculatorPage() {
  const { mutate, isPending, data, error } = usePriceCalculator();

  const handleCalculate = (requestData: PriceCalculatorRequest) => {
    mutate(requestData);
  };

  return (
    <div className="container mx-auto px-4 py-6">
      {/* Breadcrumb */}
      <nav className="mb-4 text-sm text-muted-foreground">
        <a href="/cogs" className="hover:underline">COGS Management</a>
        {' / '}
        <span>Price Calculator</span>
      </nav>

      {/* Page Header */}
      <h1 className="text-2xl font-bold mb-6">Price Calculator</h1>

      {/* Two-column layout */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Left: Input Form */}
        <div>
          <PriceCalculatorForm
            onSubmit={handleCalculate}
            loading={isPending}
          />
        </div>

        {/* Right: Results */}
        <div>
          <PriceCalculatorResults
            data={data}
            loading={isPending}
            error={error}
          />
        </div>
      </div>
    </div>
  );
}
```

### Sidebar Integration

Update existing Sidebar component to add Price Calculator link:

```typescript
// src/components/custom/Sidebar.tsx (partial update)
// Import DollarSign icon
import { DollarSign } from 'lucide-react'

// Add to navigationItems array (after COGS section)
{
  label: 'Price Calculator', // Epic 44: Price Calculator UI
  href: '/cogs/price-calculator',
  icon: DollarSign,
}

// Also update src/lib/routes.ts:
COGS: {
  ROOT: '/cogs',
  SINGLE: '/cogs/single',
  BULK: '/cogs/bulk',
  PRICE_CALCULATOR: '/cogs/price-calculator',  // NEW
},

// And update isProtectedRoute to include new route
```

### Layout Variants

**Desktop (≥1024px):**
```
┌─────────────────────────────────────────────────────────────┐
│  [Form Column 45%] │ [Results Column 55%]                   │
│                     │                                        │
│  Input fields      │  Recommended Price                     │
│  Advanced options  │  Cost Breakdown                         │
│  Calculate button  │  Visual Chart                           │
│                     │                                        │
└─────────────────────────────────────────────────────────────┘
```

**Mobile (<768px):**
```
┌─────────────────────────────┐
│  Form Section               │
│  • Input fields             │
│  • Advanced options         │
│  • Calculate button         │
├─────────────────────────────┤
│  Results Section            │
│  • Recommended price        │
│  • Cost breakdown           │
│  • Visual chart             │
└─────────────────────────────┘
```

### Invariants & Edge Cases
- **Invariant**: Page only accessible when authenticated
- **Edge case**: Small mobile screens (<375px) - ensure horizontal scroll not needed
- **Edge case**: Very large screens (>1920px) - max-width container

---

## Observability

- **Analytics**: Page view tracking
- **Metrics**: Time to first calculation

---

## Security

- **Auth**: Middleware redirect if not authenticated
- **Cabinet**: Verify user has active cabinet selected

---

## Accessibility (WCAG 2.1 AA)

- [ ] Skip navigation link
- [ ] Proper heading hierarchy (h1 > h2)
- [ ] Focus visible on interactive elements
- [ ] Touch targets ≥ 44×44px

---

## Dev Agent Record

### File List
| File | Change Type | Description |
|------|-------------|-------------|
| `src/app/(dashboard)/cogs/price-calculator/page.tsx` | CREATE | Calculator page |
| `src/components/custom/Sidebar.tsx` | UPDATE | Add Price Calculator link |
| `src/lib/routes.ts` | UPDATE | Add COGS.PRICE_CALCULATOR route |

### Change Log
1. Created Price Calculator page with layout
2. ✅ Code Review 2026-01-17: Fixed route from `/tools/` to `/cogs/` (existing pattern)
3. ✅ Code Review 2026-01-17: Changed icon from `Calculator` to `DollarSign` (avoid conflict)
4. ✅ Implementation 2026-01-17: Created page, updated Sidebar and routes, all lint-clean

### Implementation Notes (2026-01-17)
- Created `src/app/(dashboard)/cogs/price-calculator/page.tsx` (43 lines):
  - Two-column grid layout: form left, results right on desktop
  - Mobile responsive: stacked layout on smaller screens
  - Breadcrumb navigation: COGS Management > Price Calculator
  - Uses usePriceCalculator hook for mutation
- Updated `src/components/custom/Sidebar.tsx`:
  - Added DollarSign import
  - Added Price Calculator navigation item in COGS section
  - Removed unused `isActive` function (ESLint fix)
- Updated `src/lib/routes.ts`:
  - Added COGS.PRICE_CALCULATOR = '/cogs/price-calculator'
  - Added to isProtectedRoute for auth protection

### Review Follow-ups (AI-Code-Review 2026-01-17)
- [x] [AI-Review][MEDIUM] Changed route from `/tools/price-calculator` to `/cogs/price-calculator` (follows existing pattern)
- [x] [AI-Review][MEDIUM] Updated to use Sidebar instead of Navbar (existing navigation pattern)
- [x] [AI-Review][LOW] Changed icon from `Calculator` to `DollarSign` (Unit Economics uses Calculator)
- [x] [AI-Review][LOW] Updated hook call from `calculate/data/loading` to `mutate/isPending/data` (TanStack Query v5 pattern)

---

## QA Results

**Reviewer**: TBD
**Date**: TBD
**Gate Decision**: ⏳ PENDING

### AC Verification
| AC | Requirement | Status | Evidence |
|----|-------------|--------|----------|
| AC1 | Page route | ⏳ |  |
| AC2 | Page layout | ⏳ |  |
| AC3 | Navigation integration | ⏳ |  |
| AC4 | Responsive layout | ⏳ |  |
| AC5 | SEO & metadata | ⏳ |  |

### Responsive Testing
| Viewport | Expected Layout | Status |
|----------|----------------|--------|
| 1920×1080 | Two columns | ⏳ |
| 1024×768 | Two columns | ⏳ |
| 768×1024 | Stacked | ⏳ |
| 375×667 | Single column | ⏳ |
