# Epic 7: Liquidity Analysis (–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤)

## Status
Draft

---

## Overview

**Priority**: P0 - CRITICAL
**Business Impact**: 30-50% working capital efficiency improvement
**Estimated Effort**: 1.5 weeks
**Source PRD**: `../our_service_full_analytics/phase_one/PAGE_08_LIQUIDITY.md`

---

## Business Context

### The Problem: Frozen Capital Kills Growth

```
Typical Seller Scenario:
Total inventory value: 1,000,000‚ÇΩ

Breakdown by turnover:
‚Ä¢ Fast movers (‚â§30 days): 400,000‚ÇΩ ‚Üí 12x/year = 4.8M‚ÇΩ annual revenue
‚Ä¢ Medium movers (31-60 days): 300,000‚ÇΩ ‚Üí 6x/year = 1.8M‚ÇΩ annual revenue
‚Ä¢ Slow movers (61-90 days): 200,000‚ÇΩ ‚Üí 4x/year = 0.8M‚ÇΩ annual revenue
‚Ä¢ Dead stock (>90 days): 100,000‚ÇΩ ‚Üí 2x/year = 0.2M‚ÇΩ annual revenue

Total annual revenue: 7.6M‚ÇΩ

PROBLEM: 100,000‚ÇΩ (10%) is frozen in dead stock!
```

### The Solution: Liquidity Analysis

**After optimization (same 1M‚ÇΩ capital)**:
- Highly Liquid: 600,000‚ÇΩ ‚Üí 7.2M‚ÇΩ revenue (+2.4M!)
- Medium Liquid: 300,000‚ÇΩ ‚Üí 1.8M‚ÇΩ
- Low Liquid: 80,000‚ÇΩ ‚Üí 0.32M‚ÇΩ
- Dead stock: 20,000‚ÇΩ ‚Üí 0.04M‚ÇΩ
- **Total: 9.36M‚ÇΩ (+23% more revenue!)**

---

## Epic Goals

1. **4-Tier Classification**: Highly Liquid / Medium / Low / Illiquid
2. **Frozen Capital Tracking**: Total ‚ÇΩ locked in dead stock
3. **Turnover Calculation**: How fast each product sells
4. **Liquidation Planner**: Recommended discounts to free capital
5. **Portfolio Optimization**: Which products to scale, which to cut

---

## Key Formulas

### Turnover Days Calculation

```javascript
turnover_days = (avg_stock_qty √ó 30) / units_sold_last_30_days;
```

### Liquidity Classification

| Status | Turnover Days | Target Share | Action |
|--------|---------------|--------------|--------|
| üü¢ Highly Liquid | ‚â§30 days | >50% | MAXIMIZE |
| üü° Medium Liquid | 31-60 days | 30-40% | MAINTAIN |
| üü† Low Liquid | 61-90 days | <15% | REDUCE |
| üî¥ Illiquid | >90 days | <5% | LIQUIDATE |

### Frozen Capital

```javascript
frozen_capital = sum(stock_value) for SKUs where turnover_days > 90
frozen_capital_pct = (frozen_capital / total_inventory_value) √ó 100
// Target: <5%
```

---

## Architecture

### Frontend Components

```
src/
‚îú‚îÄ‚îÄ app/(dashboard)/analytics/
‚îÇ   ‚îî‚îÄ‚îÄ liquidity/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx                     ‚Üê Route page
‚îú‚îÄ‚îÄ components/custom/
‚îÇ   ‚îú‚îÄ‚îÄ LiquidityPage.tsx               ‚Üê Main layout
‚îÇ   ‚îú‚îÄ‚îÄ LiquidityDistributionChart.tsx  ‚Üê Pie chart + cards
‚îÇ   ‚îú‚îÄ‚îÄ LiquidityBenchmarks.tsx         ‚Üê Performance vs targets
‚îÇ   ‚îú‚îÄ‚îÄ LiquidityTable.tsx              ‚Üê Main data table
‚îÇ   ‚îú‚îÄ‚îÄ LiquidityTableRow.tsx           ‚Üê Single row
‚îÇ   ‚îú‚îÄ‚îÄ LiquidationPlannerModal.tsx     ‚Üê 3-scenario planner
‚îÇ   ‚îî‚îÄ‚îÄ LiquidityTrendChart.tsx         ‚Üê 90-day trends
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îî‚îÄ‚îÄ useLiquidity.ts                 ‚Üê TanStack Query hook
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ liquidity.ts                    ‚Üê TypeScript types
‚îî‚îÄ‚îÄ lib/
    ‚îî‚îÄ‚îÄ liquidity-utils.ts              ‚Üê Helper functions
```

### API Contract

**Endpoint**: `GET /v1/analytics/liquidity`

**Full specification**: `docs/request-backend/55-liquidity-api-endpoint.md`

### Data Flow

```
[LiquidityPage]
    ‚îú‚îÄ‚îÄ useLiquidity(params)
    ‚îÇ       ‚îî‚îÄ‚îÄ API: GET /v1/analytics/liquidity
    ‚îÇ
    ‚îú‚îÄ‚îÄ [LiquidityDistributionChart]
    ‚îÇ       ‚îî‚îÄ‚îÄ Pie chart + 4 category cards
    ‚îÇ
    ‚îú‚îÄ‚îÄ [LiquidityBenchmarks]
    ‚îÇ       ‚îî‚îÄ‚îÄ Your performance vs targets
    ‚îÇ
    ‚îú‚îÄ‚îÄ [LiquidityTable]
    ‚îÇ       ‚îú‚îÄ‚îÄ Sortable columns
    ‚îÇ       ‚îú‚îÄ‚îÄ Status filtering (from cards)
    ‚îÇ       ‚îú‚îÄ‚îÄ Row colors by category
    ‚îÇ       ‚îî‚îÄ‚îÄ Action buttons (Scale Up, Reduce, Discount)
    ‚îÇ
    ‚îú‚îÄ‚îÄ [LiquidationPlannerModal]
    ‚îÇ       ‚îî‚îÄ‚îÄ 3 liquidation scenarios with ROI math
    ‚îÇ
    ‚îî‚îÄ‚îÄ [LiquidityTrendChart]
            ‚îî‚îÄ‚îÄ 90-day stacked area chart
```

---

## Stories

| Story | Title | Description | Backend Dependency |
|-------|-------|-------------|-------------------|
| 7.1 | API Integration | TypeScript types, hook, helpers | Request #55 |
| 7.2 | Page Structure | Layout, distribution dashboard, benchmarks | - |
| 7.3 | Table & Liquidation Planner | Main table, action buttons, planner modal | - |
| 7.4 | Integration & Testing | Tests, E2E, performance | - |

---

## UX/UI Expert Sections

> **‚ö†Ô∏è REQUIRES UX/UI EXPERT INPUT**

### Distribution Dashboard Design
- [ ] Pie chart vs horizontal bar layout
- [ ] Card dimensions and spacing
- [ ] Status icon and color system
- [ ] Animation for chart/cards

### Benchmarks Section
- [ ] Table vs card layout
- [ ] Progress indicators style
- [ ] Color coding for status

### Table Design
- [ ] Row height and padding
- [ ] Column alignment
- [ ] Number formatting
- [ ] Action button variants by category

### Liquidation Planner Modal
- [ ] Modal width and layout
- [ ] 3 scenarios presentation
- [ ] ROI visualization
- [ ] Call-to-action buttons

### Trend Chart
- [ ] Stacked area vs line chart
- [ ] Color palette for 4 categories
- [ ] Time period selector
- [ ] Insight annotations

---

## Success Metrics

### Adoption (Week 1)
- 50% of users visit page
- 25% use Liquidation Planner
- 10% liquidate at least 1 SKU

### Business Impact (Month 1)
- Users liquidate 30% of illiquid stock
- Average frozen capital drops from 10% ‚Üí 5%

### Business Impact (Month 3)
- 20-30% revenue increase (same capital)
- Average turnover improves: 52 ‚Üí 38 days
- Frozen capital <5% across all users

---

## Dependencies

- **Backend**: Request #55 - Liquidity API endpoint
- **Data**: Stock snapshots, sales history, COGS
- **Integration**: Supply Planning (cross-link for restocking)
- **Future**: Repricing module (auto-apply discounts)

---

## Out of Scope (Future)

1. Auto-repricing integration (apply discounts automatically)
2. Weekly email reports
3. Frozen capital alerts
4. Turnover deterioration detection
5. PDF export of liquidation plans

---

## Related Documentation

- **Source PRD**: `../our_service_full_analytics/phase_one/PAGE_08_LIQUIDITY.md`
- **Backend Request**: `docs/request-backend/55-liquidity-api-endpoint.md`
- **Stories**: `docs/stories/7.1-7.4.*.md`

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-09 | 1.0 | Initial epic creation | Sarah (PO) |
